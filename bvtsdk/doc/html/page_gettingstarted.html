<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>ProViewer SDK: Getting Started</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ProViewer SDK
   &#160;<span id="projectnumber">4.4.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('page_gettingstarted.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Getting Started </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#section_overview">Overview of the C API</a></li>
<li class="level1"><a href="#section_read_son_file">Reading a .son File</a></li>
<li class="level1"><a href="#section_connect_to_live_sonar">Connecting to a Sonar over Ethernet</a></li>
<li class="level1"><a href="#section_imagebuilding">Image Creation</a></li>
<li class="level1"><a href="#section_colormapping">Color Mapping</a></li>
<li class="level1"><a href="#section_saving_son_file">Saving a .son File</a></li>
<li class="level1"><a href="#section_opencv">Interfacing with OpenCV</a></li>
</ul>
</div>
<div class="textblock"><p>This section is designed as an introduction to building custom application using the BlueView SDK. Example code contained in this section isn't designed to be complete, but is to be used as a starting point for the reader's own exploration. As such, it often doesn't do important things such as error checking.</p>
<h1><a class="anchor" id="section_overview"></a>
Overview of the C API</h1>
<p>Although C isn't considered an object oriented language, it is still possible to use many common object oriented programming techniques. Classes can be implemented as opaque typedefs with conveniently named functions to act as member functions. The BlueView SDK follows this design pattern.</p>
<p>The SDK consists of a small number of such types. They are as follows: Sonar, Head, Ping, ImageGenerator, MagImage, ColorMapper, ColorImage, Logger, and Error. To prevent name space pollution, all the objects carry the BVT prefix. The following sections offer basic descriptions of each of these classes.</p>
<p><b>Sonar</b> <br />
 The Sonar object is the top level object in the SDK. It embodies communication with a single physical sonar unit, or file. Sonar also provides a function to create new data files using BlueView's .son format.</p>
<p><b>Head</b> <br />
 Most user interaction occurs with the Head object. A head consists of a group of co-planar transducers which are operated simultaneously to produce (ultimately) a single 2D image. The Head object provides functions to change the range window as well as produce pings. While most BlueView sonar only have a single head, the SDK supports sonar with multiple heads.</p>
<p><b>Ping</b> <br />
 As its name implies, the Ping object represents the return from a single ping on a particular head. A Ping object also contains information about its parent Head at the time the ping was acquired, such as orientation and navigation data.</p>
<p><b>ImageGenerator</b> <br />
 GetImageXY is the most important function in ImageGenerator as it does whatever processing is necessary to convert a ping to an image.</p>
<p><b>MagImage</b> <br />
 MagImage is short for MagnitudeImage. It provides access to a 2d image where each pixel is intensity of the return from a particular point on a plane emanating from the head. I can be thought of as a 16bit gray-scale image.</p>
<p><b>ColorMapper</b> <br />
 Unfortunately, a MagImage isn't overly useful for display. The ColorMapper object simplifies the process of mapping each pixel of a MagImage to a RGB value according to a colormap and several parameters.</p>
<p><b>ColorImage</b> <br />
 The ColorImage object is identical to MagImage with the exception that each pixel is now a 32bit integer representing the red, green, and blue values assigned by the colormap.</p>
<p><b>Logger</b> <br />
 The SDK is capable of producing a significant amount of debugging output. The Logger object exists to allow the user to control (or disable) the output. Users can also use Logger to add their own custom log messages.</p>
<p><b>Error</b> <br />
 The Error object provides access to the SDKs error reporting system. This allows the user to map from an error number to a human readable description of the error.</p>
<h1><a class="anchor" id="section_read_son_file"></a>
Reading a .son File</h1>
<dl class="section note"><dt>Note</dt><dd>The following examples do not show error handling. Please see <a class="el" href="page_error_handling.html">Error Handling for Robust Code</a> for more information.</dd></dl>
<p>Most applications using the BlueView SDK generally follow the same basic pattern. Listing <a class="el" href="page_gettingstarted.html#section_read_son_file">Reading a .son File</a> shows the process of connecting to a sonar (in this case, a .son file), accessing one of its heads, and acquiring pings. The SDK is designed so that reading files is nearly identical to working with real hardware. The differences between the two are highlighted in section <a class="el" href="page_gettingstarted.html#section_connect_to_live_sonar">Connecting to a Sonar over Ethernet</a> <a class="anchor" id="snippet_read_son_file"></a></p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bvt__sdk_8h.html">bvt_sdk.h</a>&gt;</span></div></div><!-- fragment --> <div class="fragment"><div class="line">1  <a class="code" href="group__BVTSonar.html#ga2c4cae2e095ff546483e54c4b439699b">BVTSonar</a> sonar = <a class="code" href="group__BVTSonar.html#ga451aec1f8edcd79640584232fcf43c03">BVTSonar_Create</a>();</div><div class="line">2  <a class="code" href="group__BVTSonar.html#ga66aa14d7802e2d17f2ee962ee983e545">BVTSonar_Open</a>(sonar, <span class="stringliteral">&quot;FILE&quot;</span>, <span class="stringliteral">&quot;swimmer.son&quot;</span>);</div><div class="line"></div><div class="line">3  <a class="code" href="group__BVTHead.html#ga16fd35d915bef8f4b779d7ed912e9e57">BVTHead</a> head = NULL;</div><div class="line">4  <a class="code" href="group__BVTSonar.html#ga34c5b6786ea9df3eb0dcd0c539836a42">BVTSonar_GetHead</a>(sonar, 0, &amp;head);</div><div class="line"></div><div class="line">5  <a class="code" href="group__BVTPing.html#gab5651050462b29352e549a665ec79d0f">BVTPing</a> ping = NULL;</div><div class="line">6  <a class="code" href="group__BVTHead.html#gab28fd74da542927db1b9267bd41d37ec">BVTHead_GetPing</a>(head, 0, &amp;ping);</div><div class="line"></div><div class="line">   <span class="comment">/* Do something useful with the ping here */</span></div><div class="line"></div><div class="line">7  <a class="code" href="group__BVTPing.html#gaef1e2bde711211a0b9a345cf3b33b5a9">BVTPing_Destroy</a>(ping);</div><div class="line">8  <a class="code" href="group__BVTHead.html#gae954eff661f25db70d843e252abe1731">BVTHead_Destroy</a>(head);</div><div class="line">9  <a class="code" href="group__BVTSonar.html#ga6194881403b3962c8562af6128f50283">BVTSonar_Destroy</a>(sonar);</div></div><!-- fragment --><p> Let's dig into Listing <a class="el" href="page_gettingstarted.html#section_read_son_file">Reading a .son File</a>. First you must include the main SDK header, <a class="el" href="bvt__sdk_8h.html">bvt_sdk.h</a>. It automatically includes the needed files from <code>include/bvt_c</code>. In order for the compiler/preprocessor to find it, you must make sure that the path to <code>include/</code> is in the compiler's include path.</p>
<p>Line 1 creates a new Sonar object for use. To prevent memory leaks, this object is then destroyed when we are done with it on line 9. The next step is to open a 'connection` to the sonar, which is on line 2. In this case, we specify that we will open a file named <code>swimmer.son</code>. The SDK is designed so that reading files is nearly identical to working with real hardware.</p>
<p>Now that we have an open Sonar object, the next thing we usually want to do is retrieve a head object. In this case, we get the first head on line 4. Note that a file collected from a sonar with multiple heads will also have multiple Heads. In this case, we know that <code>swimmer.son</code> only has one head. To prevent memory leaks, the Head object is then destroyed when we are done with it on line 8, always before the Sonar object is destroyed.</p>
<p>Finally, we ask the Head for its first ping on line 6. A file will typically have multiple pings available (<a class="el" href="group__BVTHead.html#gaed20dac4423787b97ba07a571a15f7cf">BVTHead_GetPingCount</a>) where as an Ethernet device will only have a single ping. Either way, using a ping number of <b>-1</b> gets the <em>next</em> ping available. We destroy the ping to prevent memory leaks (line 8). Note that <a class="el" href="group__BVTHead.html#gab28fd74da542927db1b9267bd41d37ec">BVTHead_GetPing</a> only encompasses the ping transmission and acquisition phases. See the next section for information about actually building an image.</p>
<h1><a class="anchor" id="section_connect_to_live_sonar"></a>
Connecting to a Sonar over Ethernet</h1>
<p>Most applications using this SDK will eventually connect to a sonar to collect live data. </p><div class="fragment"><div class="line"> 1  <a class="code" href="group__BVTSonar.html#ga2c4cae2e095ff546483e54c4b439699b">BVTSonar</a> son = <a class="code" href="group__BVTSonar.html#ga451aec1f8edcd79640584232fcf43c03">BVTSonar_Create</a>();</div><div class="line"> 2  <a class="code" href="group__BVTSonar.html#ga66aa14d7802e2d17f2ee962ee983e545">BVTSonar_Open</a>(sonar, <span class="stringliteral">&quot;NET&quot;</span>, <span class="stringliteral">&quot;192.168.1.45&quot;</span>);</div><div class="line"></div><div class="line"> 3  <a class="code" href="group__BVTHead.html#ga16fd35d915bef8f4b779d7ed912e9e57">BVTHead</a> head = NULL;</div><div class="line"> 4  <a class="code" href="group__BVTSonar.html#ga34c5b6786ea9df3eb0dcd0c539836a42">BVTSonar_GetHead</a>(sonar, 0, &amp;head);</div><div class="line"></div><div class="line"> 5  <a class="code" href="group__BVTHead.html#gaeee3fef3670416ba615c3489c49d264c">BVTHead_SetRange</a>(head, 1, 10);</div><div class="line"></div><div class="line"> 6  <a class="code" href="group__BVTPing.html#gab5651050462b29352e549a665ec79d0f">BVTPing</a> ping = NULL;</div><div class="line"> 7  <a class="code" href="group__BVTError.html#ga13a111edd6fa7c55525730ea43942579">RetVal</a> ret = <a class="code" href="group__BVTHead.html#gab28fd74da542927db1b9267bd41d37ec">BVTHead_GetPing</a>(head, -1, &amp;ping);</div><div class="line"></div><div class="line"> 8  <a class="code" href="group__BVTPing.html#gaef1e2bde711211a0b9a345cf3b33b5a9">BVTPing_Destroy</a>(ping);</div><div class="line"> 9  <a class="code" href="group__BVTHead.html#gae954eff661f25db70d843e252abe1731">BVTHead_Destroy</a>(head);</div><div class="line">10  <a class="code" href="group__BVTSonar.html#ga6194881403b3962c8562af6128f50283">BVTSonar_Destroy</a>(sonar);</div></div><!-- fragment --><p>There are only three differences between <a class="el" href="page_gettingstarted.html#section_read_son_file">Reading a .son File</a> and <a class="el" href="page_gettingstarted.html#section_connect_to_live_sonar">Connecting to a Sonar over Ethernet</a>. First, the call to <a class="el" href="group__BVTSonar.html#ga66aa14d7802e2d17f2ee962ee983e545">BVTSonar_Open</a> on line 2 is slightly different. When opening a file, the type parameter is "FILE". Ethernet sonar devices use "NET", and substitute an IP address as a parameter rather than a file name.</p>
<p>Second, <a class="el" href="group__BVTHead.html#gab28fd74da542927db1b9267bd41d37ec">BVTHead_GetPing</a> is called with a ping number of <b>-1</b>. This means that the sonar will return the next available ping, which is all it really has anyway. This function causes the sonar to immediately emit a ping in the water and return the signal data. It does not actually process the return to build an image. See Section <a class="el" href="page_gettingstarted.html#section_imagebuilding">Image Creation</a> for more information on how to do that.</p>
<p>Third, each sonar has a default range window. For files, this is the range window at which it was recorded. As shown in line 5, the SetRange function can be used to override the start and stop of the window. If you decrease the stop distance then the sonar will listen for a shorter period of time, so you will not see as far, but you may want more frequently updated imagery. </p><dl class="section warning"><dt>Warning</dt><dd>You can change the range window with <a class="el" href="group__BVTHead.html#gaeee3fef3670416ba615c3489c49d264c">BVTHead_SetRange</a> at any time except when you are saving data.</dd></dl>
<h1><a class="anchor" id="section_imagebuilding"></a>
Image Creation</h1>
<p>As mentioned above, <a class="el" href="group__BVTHead.html#gab28fd74da542927db1b9267bd41d37ec">BVTHead_GetPing</a> does not actually take the time to process an image. Image processing can be time consuming, so splitting the two operations gives you flexibility.</p>
<dl class="section note"><dt>Note</dt><dd>The image will appear distorted if the sound speed is improperly set using <a class="el" href="group__BVTHead.html#gad810a9205d2c0061c1cf47adf5e7de0b">BVTHead_SetSoundSpeed</a>.</dd></dl>
<div class="fragment"><div class="line">  <span class="comment">/* Assume that we&#39;re connected to a Sonar and have a Head... */</span></div><div class="line"> 1  <a class="code" href="group__BVTPing.html#gab5651050462b29352e549a665ec79d0f">BVTPing</a> ping = NULL;</div><div class="line"> 2  <a class="code" href="group__BVTHead.html#gab28fd74da542927db1b9267bd41d37ec">BVTHead_GetPing</a>(head, -1, &amp;ping);</div><div class="line"></div><div class="line"> 3  <a class="code" href="group__BVTImageGenerator.html#gad50757e6d60edad3379fa378e5fb6725">BVTImageGenerator</a> imager = <a class="code" href="group__BVTImageGenerator.html#ga24368f74cb370b5a0f2a437d44af9285">BVTImageGenerator_Create</a>();</div><div class="line"> 4  <a class="code" href="group__BVTImageGenerator.html#gae8945fcafe722fcc78534189660c269d">BVTImageGenerator_SetHead</a>(head);</div><div class="line"></div><div class="line"> 5  <a class="code" href="group__BVTMagImage.html#gad302044bd1e96520ca8d539a131a81be">BVTMagImage</a> img;</div><div class="line"> 6  <a class="code" href="group__BVTImageGenerator.html#ga2c16456fbdf582885ca0bfd6643523ed">BVTImageGenerator_GetImageXY</a>(imager, ping, &amp;img);</div><div class="line"></div><div class="line"> 7  <span class="keywordtype">int</span> height = 0;</div><div class="line"> 8  <a class="code" href="group__BVTMagImage.html#gab6f458d4a2a6092f7f073548476a79ac">BVTMagImage_GetHeight</a>(img, &amp;height);</div><div class="line"> 9  <span class="keywordtype">int</span> width = 0;</div><div class="line">10  <a class="code" href="group__BVTMagImage.html#ga2a4fd096118149caab9509e28c0ea47e">BVTMagImage_GetWidth</a>(img, &amp;width);</div><div class="line"></div><div class="line">11  <a class="code" href="group__BVTMagImage.html#gaecdb73473832a77665a1c03e219ab3a0">BVTMagImage_SavePGM</a>(img, <span class="stringliteral">&quot;img.pgm&quot;</span>);</div><div class="line"></div><div class="line">12  <a class="code" href="group__BVTMagImage.html#ga2c03707e63c7ceaf46600d634e797817">BVTMagImage_Destroy</a>(img);</div><div class="line">13  <a class="code" href="group__BVTPing.html#gaef1e2bde711211a0b9a345cf3b33b5a9">BVTPing_Destroy</a>(ping);</div><div class="line">14  <a class="code" href="group__BVTImageGenerator.html#gafbfa6b730dddee1200703945f45c78e2">BVTImageGenerator_Destroy</a>(imager);</div></div><!-- fragment --><p>In <a class="el" href="page_gettingstarted.html#section_imagebuilding">Image Creation</a>, we first acquire a ping on Line 2 exactly as we've done before. Next, we create an image generator and tell it which head to use. Finally we process the ping into an image with the call to <a class="el" href="group__BVTImageGenerator.html#ga2c16456fbdf582885ca0bfd6643523ed">BVTImageGenerator_GetImageXY</a> on Line 6. This operation could potentially be time consuming depending on the resolution and range requested (See the BVTImageGenerator documentation for more information). Lines <a class="el" href="group__BVTMagImage.html#gab6f458d4a2a6092f7f073548476a79ac">BVTMagImage_GetHeight</a> <a class="el" href="group__BVTMagImage.html#ga2a4fd096118149caab9509e28c0ea47e">BVTMagImage_GetWidth</a> and <a class="el" href="group__BVTMagImage.html#gaecdb73473832a77665a1c03e219ab3a0">BVTMagImage_SavePGM</a> illustrate some common image operations. Finally, to prevent memory leaks, we destroy the image, ping, and image generator on lines 12 through 14.</p>
<h1><a class="anchor" id="section_colormapping"></a>
Color Mapping</h1>
<p>The <a class="el" href="group__BVTMagImage.html">image</a> produced by <a class="el" href="group__BVTPing.html#ga07d28bd43cc89f0c0c5bfa1f0436a2d7">BVTPing_GetImageXY</a> is in greyscale with a depth of 16bits. Therefore the image isn't suitable for viewing by humans on a standard monitor. A very common operation on an image of this kind is to map e 16-bit pixels into RGB color space using a colormap. To make this process easier, the SDK provides the <a class="el" href="group__BVTColorMapper.html">BVTColorMapper</a> object along with several example colormap files.</p>
<dl class="section note"><dt>Note</dt><dd>The colormap files are found in the directory <code>colormaps/</code> </dd></dl>
<div class="fragment"><div class="line"> <span class="comment">/* Assume that we&#39;ve got a ping and image generator ... */</span></div><div class="line"> 1 <a class="code" href="group__BVTMagImage.html#gad302044bd1e96520ca8d539a131a81be">BVTMagImage</a> img;</div><div class="line"> 2 <a class="code" href="group__BVTImageGenerator.html#ga2c16456fbdf582885ca0bfd6643523ed">BVTImageGenerator_GetImageXY</a>(ping, &amp;img);</div><div class="line"></div><div class="line"> 3 <a class="code" href="group__BVTColorMapper.html#ga6541b3e4971ec65e46c5847d009c28d2">BVTColorMapper</a> mapper = <a class="code" href="group__BVTColorMapper.html#gaae5f9a4950e314fccb1f94d7931b11e0">BVTColorMapper_Create</a>();</div><div class="line"> 4 <a class="code" href="group__BVTColorMapper.html#ga259207df5d34163a94739cf89b79eca5">BVTColorMapper_Load</a>(mapper, <span class="stringliteral">&quot;colormaps/bone.cmap&quot;</span>);</div><div class="line"></div><div class="line"> 5 <a class="code" href="group__BVTColorImage.html#ga842ce8b58a011d7f2f3dfe378bc34887">BVTColorImage</a> cimg;</div><div class="line"> 6 <a class="code" href="group__BVTColorMapper.html#ga8d5eb7564b9eb32dddcbbd7e4e9e1f88">BVTColorMapper_MapImage</a>(mapper, img, &amp;cimg);</div><div class="line"></div><div class="line"> 7 <a class="code" href="group__BVTMagImage.html#ga2c03707e63c7ceaf46600d634e797817">BVTMagImage_Destroy</a>(img); <span class="comment">/* Don&#39;t need the MagImage at this point */</span></div><div class="line"> 8 <a class="code" href="group__BVTColorMapper.html#gaef8ba41ffe0bb2cca8b37950704b06ab">BVTColorMapper_Destroy</a>(mapper);</div><div class="line"></div><div class="line"> 9 <a class="code" href="group__BVTColorImage.html#ga47a96650f406df23fb670ed3999c2478">BVTColorImage_SavePPM</a>(cimg, <span class="stringliteral">&quot;cimg.ppm&quot;</span>);</div><div class="line">10 <a class="code" href="group__BVTColorImage.html#gaedefcdcd3a96c1994b53c3d531d318bb">BVTColorImage_Destroy</a>(cimg);</div></div><!-- fragment --><p>As with several other objects, we need to <a class="el" href="group__BVTColorMapper.html#gaae5f9a4950e314fccb1f94d7931b11e0">create a BVTColorMapper.</a> It is destroyed on line 10 to prevent memory leaks. For this example, we use the color map stored in the file <code>"bone.cmap"</code> which is a common 'nearly gray scale' color map. Although they aren't shown in this example, BVTColorMapper has two functions available to control exactly how this colormap is applied to the image: <a class="el" href="group__BVTColorMapper.html#ga8ab4e29dc97fad3d9d441a233e42b7d4">BVTColorMapper_SetGamma</a> and <a class="el" href="group__BVTColorMapper.html#gab0db1ad8af16ecd686df7970d29fb8ac">BVTColorMapper_SetThresholds</a>. The latter is probably the most important of the two. See <a class="el" href="group__BVTColorMapper.html#gab0db1ad8af16ecd686df7970d29fb8ac">its documentation</a> for more information. Once the color map is loaded and configured, it is time to call <a class="el" href="group__BVTColorMapper.html#ga8d5eb7564b9eb32dddcbbd7e4e9e1f88">BVTColorMapper_MapImage</a> to convert the <a class="el" href="group__BVTMagImage.html">BVTMagImage</a> to a <a class="el" href="group__BVTColorImage.html">BVTColorImage</a>. Note that this allocates a BVTColorImage, and we destroy it . Line 9 writes the image to the file <code>"cimg.ppm"</code>. </p><dl class="section note"><dt>Note</dt><dd>BlueView's ProViewer desktop application uses the <code>"copper.cmap"</code> color map by default.</dd></dl>
<h1><a class="anchor" id="section_saving_son_file"></a>
Saving a .son File</h1>
<p>The previous sections have dealt with operations designed to produce an image suitable for display or other processing. The SDK is also able to save sonar data in <a class="el" href="page_son_file_format.html">BlueView's .son file format</a>. A .son file stores the sonar data in a highly compressed, but lossless, format. This allows the user to load the file back into ProViewer (or use the SDK) either for review or for higher-resolution processing. The following example shows how to save a series of pings to a file.</p>
<div class="fragment"><div class="line">    <span class="comment">/* Assume that we&#39;re connected to a Sonar (source_sonar)... */</span></div><div class="line"> 1  <a class="code" href="group__BVTSonar.html#ga2c4cae2e095ff546483e54c4b439699b">BVTSonar</a> file = <a class="code" href="group__BVTSonar.html#ga451aec1f8edcd79640584232fcf43c03">BVTSonar_Create</a>();</div><div class="line"></div><div class="line"> 2  <a class="code" href="group__BVTSonar.html#gaabd27ed46038993979a45bb78a98ac7d">BVTSonar_CreateFile</a>(file, <span class="stringliteral">&quot;out.son&quot;</span>, source_sonar, <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"></div><div class="line"> 3  <span class="keyword">const</span> <span class="keywordtype">int</span> head_index = 0; <span class="comment">/* pick the first head */</span></div><div class="line"></div><div class="line"> 4  <a class="code" href="group__BVTHead.html#ga16fd35d915bef8f4b779d7ed912e9e57">BVTHead</a> source_head = NULL;</div><div class="line"> 5  <a class="code" href="group__BVTSonar.html#ga34c5b6786ea9df3eb0dcd0c539836a42">BVTSonar_GetHead</a>(source_sonar, head_index, &amp;source_head);</div><div class="line"></div><div class="line"> 6  <a class="code" href="group__BVTHead.html#ga16fd35d915bef8f4b779d7ed912e9e57">BVTHead</a> file_head = NULL;</div><div class="line"> 7  <a class="code" href="group__BVTSonar.html#ga34c5b6786ea9df3eb0dcd0c539836a42">BVTSonar_GetHead</a>(file, head_index, &amp;file_head);</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 10; i++) {</div><div class="line"> 8      <a class="code" href="group__BVTPing.html#gab5651050462b29352e549a665ec79d0f">BVTPing</a> ping = NULL;</div><div class="line"> 9      <a class="code" href="group__BVTHead.html#gab28fd74da542927db1b9267bd41d37ec">BVTHead_GetPing</a>(source_head, -1, &amp;ping);</div><div class="line">10      <a class="code" href="group__BVTHead.html#ga16fae702c19f76ee25e3386f23e7f2d4">BVTHead_PutPing</a>(file_head, ping);</div><div class="line">11      <a class="code" href="group__BVTPing.html#gaef1e2bde711211a0b9a345cf3b33b5a9">BVTPing_Destroy</a>(ping);</div><div class="line">    }</div><div class="line"></div><div class="line">12   <a class="code" href="group__BVTSonar.html#ga6194881403b3962c8562af6128f50283">BVTSonar_Destroy</a>(file); <span class="comment">/* close the file */</span></div></div><!-- fragment --><p>New files are created by 'cloning` an existing sonar. This ensures that the various required parameters propagate to the file. This cloning is a accomplished on line 2. In this case, we're creating a file named <code>"out.son"</code> by cloning the Sonar object, <code>sonar_source</code>. As in previous examples, we acquire a head object to operate on. However, this time we acquire <em>two</em> heads (Lines 5 and 7. The first, <code>source_head</code> becomes our source. The second, <code>out_head</code> becomes our destination.</p>
<p>The actual meat of the example is the body of the for loop. First, we call the familiar <a class="el" href="group__BVTHead.html#gab28fd74da542927db1b9267bd41d37ec">BVTHead_GetPing</a> function which acquires a ping. Next, we save the ping to the file using <a class="el" href="group__BVTHead.html#ga16fae702c19f76ee25e3386f23e7f2d4">BVTHead_PutPing</a>. Finally, we destroy the ping to prevent memory leaks. Once the loop completes, <code>"out.son"</code> will contain 10 pings.</p>
<dl class="section note"><dt>Note</dt><dd>We defined a common <code>head_index</code> on Line 3 to make sure that we didn't pass different indices to the two different calls to <a class="el" href="group__BVTSonar.html#ga34c5b6786ea9df3eb0dcd0c539836a42">BVTSonar_GetHead</a>.</dd></dl>
<h1><a class="anchor" id="section_opencv"></a>
Interfacing with OpenCV</h1>
<p>OpenCV (<code><a href="http://http://opencv.org">http://http://opencv.org</a></code>) is an open source library that contains many common image processing and computer vision algorithms. It is also capable of accelerated processing on various hardware platforms. <code>IplImage</code> is the core image structure used by OpenCV. The following lists show how to create plImage structures from <a class="el" href="group__BVTMagImage.html">BVTMagImage</a> and <a class="el" href="group__BVTColorImage.html">BVTColorImage</a> objects:</p>
<p>Creating an <code>IplImage</code> from a <a class="el" href="group__BVTMagImage.html">BVTMagImage</a> </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> height = 0;</div><div class="line"><a class="code" href="group__BVTMagImage.html#gab6f458d4a2a6092f7f073548476a79ac">BVTMagImage_GetHeight</a>(img, &amp;height);</div><div class="line"><span class="keywordtype">int</span> width = 0;</div><div class="line"><a class="code" href="group__BVTMagImage.html#ga2a4fd096118149caab9509e28c0ea47e">BVTMagImage_GetWidth</a>(img, &amp;width);</div><div class="line"></div><div class="line">IplImage* gray_img = cvCreateImageHeader(cvSize(width,height), IPL_DEPTH_16U, 1);</div><div class="line">cvSetImageData(gray_img, <a class="code" href="group__BVTMagImage.html#gab987f3fc34262689fc542cd605f1edc1">BVTMagImage_GetBits</a>(img), width * 2);</div><div class="line"></div><div class="line"><span class="comment">/* Use gray_img for something */</span></div><div class="line"></div><div class="line">cvReleaseImageHeader(&amp;gray_img);</div><div class="line"><a class="code" href="group__BVTMagImage.html#ga2c03707e63c7ceaf46600d634e797817">BVTMagImage_Destroy</a>(img);</div></div><!-- fragment --><p>Creating an <code>IplImage</code> from a <a class="el" href="group__BVTColorImage.html">BVTColorImage</a> </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> height = 0;</div><div class="line"><a class="code" href="group__BVTColorImage.html#ga3d0231a99e1ad3b673e5a62ce843c98b">BVTColorImage_GetHeight</a>(img, &amp;height);</div><div class="line"><span class="keywordtype">int</span> width = 0;</div><div class="line"><a class="code" href="group__BVTColorImage.html#ga3d0231a99e1ad3b673e5a62ce843c98b">BVTColorImage_GetHeight</a>(img, &amp;width);</div><div class="line"></div><div class="line">IplImage* color_img = cvCreateImageHeader(cvSize(width,height), IPL_DEPTH_8U, 4);</div><div class="line">cvSetImageData(color_img,  <a class="code" href="group__BVTColorImage.html#ga706f69e819f28d5963f458e91fc921dc">BVTColorImage_GetBits</a>(cimg), width*4);</div><div class="line"></div><div class="line"><span class="comment">/* Use color_img for something */</span></div><div class="line"></div><div class="line">cvReleaseImageHeader(&amp;color_img);</div><div class="line"><a class="code" href="group__BVTColorImage.html#gaedefcdcd3a96c1994b53c3d531d318bb">BVTColorImage_Destroy</a>(cimg);</div></div><!-- fragment --><p>This technique `wraps' an <code>IplImage</code> around the image buffer owned by the SDK by using <code>cvCreateImageHeader</code>. This means that you should call <code>cvReleaseImageHeader</code> to have OpenCV deallocate just its information without touching the image data buffer. That buffer will be deallocated in <a class="el" href="group__BVTColorImage.html#gaedefcdcd3a96c1994b53c3d531d318bb">BVTColorImage_Destroy</a>. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri May 19 2017 14:18:08 for ProViewer SDK by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
